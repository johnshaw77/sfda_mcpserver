# Wilcoxon 符號秩檢定工具測試案例

## 工具概述
Wilcoxon 符號秩檢定是配對樣本 t 檢定的非參數替代方法，用於比較配對資料的中位數差異，不需要假設差值符合常態分佈。

## 統計專業情境

### 情境 1: 配對藥物治療前後比較
**研究背景**: 評估抗憂鬱藥物治療前後的憂鬱量表分數變化，量表分數為序位資料
**研究設計**: 配對前後測設計，序位尺度測量
**假設**: H₀: 治療前後中位數差異為0 vs H₁: 治療前後中位數差異不為0

**測試數據**:
```json
{
  "before": [28, 32, 25, 35, 30, 27, 33, 29, 31, 26, 34, 28, 30, 32, 29],
  "after": [22, 25, 19, 28, 24, 21, 26, 23, 25, 20, 27, 22, 24, 26, 23],
  "alpha": 0.05,
  "alternative": "two-sided",
  "context": {
    "scenario": "medical",
    "variable_name": "憂鬱量表分數",
    "measurement_type": "序位資料",
    "study_design": "配對前後測",
    "treatment": "抗憂鬱藥物治療"
  }
}
```

### 情境 2: 配對學習方法效果比較
**研究背景**: 比較學生使用新學習方法前後的表現，資料呈現偏態分佈
**研究設計**: 配對設計，同一群學生前後測
**假設**: H₀: 新方法無效果 vs H₁: 新方法有效果

**測試數據**:
```json
{
  "before": [65, 72, 58, 81, 69, 74, 62, 78, 66, 73, 60, 79, 67, 75, 63],
  "after": [78, 85, 71, 94, 82, 87, 75, 91, 79, 86, 73, 92, 80, 88, 76],
  "alpha": 0.05,
  "alternative": "greater",
  "context": {
    "scenario": "education",
    "variable_name": "學習成效分數",
    "measurement_type": "偏態分佈資料",
    "study_design": "配對前後測",
    "treatment": "新學習方法"
  }
}
```

### 情境 3: 血壓藥物療效評估（小樣本）
**研究背景**: 評估新降血壓藥物效果，樣本數較小且分佈未知
**研究設計**: 配對設計，小樣本研究
**假設**: H₀: 藥物無降壓效果 vs H₁: 藥物有降壓效果

**測試數據**:
```json
{
  "before": [142, 138, 155, 148, 162, 151, 145, 139],
  "after": [135, 131, 147, 140, 153, 143, 137, 132],
  "alpha": 0.05,
  "alternative": "less",
  "context": {
    "scenario": "medical",
    "variable_name": "收縮壓 (mmHg)",
    "measurement_type": "小樣本，分佈未知",
    "study_design": "配對前後測",
    "treatment": "降血壓藥物"
  }
}
```

### 情境 4: 軟板製造製程改善效果評估
**研究背景**: 評估軟板製程改善措施對良率的影響，數據可能偏態分佈
**研究設計**: 配對設計，同一批設備改善前後比較
**假設**: H₀: 改善措施無效果 vs H₁: 改善措施提升良率

**測試數據**:
```json
{
  "before": [92.1, 93.5, 91.8, 94.2, 92.7, 93.8, 91.4, 94.0, 92.9, 93.3],
  "after": [94.8, 95.2, 94.1, 96.7, 95.3, 95.9, 94.2, 96.4, 95.6, 95.1],
  "alpha": 0.05,
  "alternative": "greater",
  "context": {
    "scenario": "manufacturing",
    "variable_name": "良率 (%)",
    "measurement_type": "可能偏態分佈",
    "study_design": "配對前後測",
    "treatment": "製程改善措施",
    "industry": "軟板製造業"
  }
}
```

### 情境 5: 軟板製造壓合條件最佳化效果
**研究背景**: 評估調整壓合溫度對軟板剝離強度的改善效果
**研究設計**: 配對設計，同一批產品不同壓合條件比較
**假設**: H₀: 溫度調整無效果 vs H₁: 溫度調整提升剝離強度

**測試數據**:
```json
{
  "before": [4.2, 4.5, 4.1, 4.8, 4.3, 4.6, 4.0, 4.7, 4.4, 4.5, 4.2, 4.9],
  "after": [5.1, 5.4, 4.8, 5.7, 5.2, 5.5, 4.9, 5.6, 5.3, 5.4, 5.0, 5.8],
  "alpha": 0.05,
  "alternative": "greater",
  "context": {
    "scenario": "manufacturing",
    "variable_name": "剝離強度 (N/mm)",
    "measurement_type": "工程測量，可能偏態",
    "study_design": "配對前後測",
    "treatment": "壓合溫度最佳化",
    "industry": "軟板製造業",
    "process_parameter": "壓合溫度"
  }
}
```

## 一般用戶情境

### 情境 1: 減重計畫效果評估
**生活情境**: 想知道執行減重計畫兩個月後體重是否有明顯變化
**數據**: 12 個人減重前後的體重記錄

**測試數據**:
```json
{
  "before": [75.2, 82.1, 68.5, 91.3, 77.8, 85.6, 73.4, 79.9, 88.2, 71.7, 84.3, 76.9],
  "after": [72.8, 79.5, 66.1, 88.7, 75.3, 82.9, 70.8, 77.2, 85.1, 69.4, 81.7, 74.5],
  "alpha": 0.05,
  "alternative": "less",
  "context": {
    "scenario": "general",
    "variable_name": "體重 (公斤)",
    "measurement_type": "連續資料",
    "study_design": "個人前後比較",
    "treatment": "減重計畫"
  }
}
```

### 情境 2: 運動訓練心率改善
**生活情境**: 健身教練想知道學員經過一個月訓練後靜態心率是否有改善
**數據**: 15 位學員訓練前後的靜態心率

**測試數據**:
```json
{
  "before": [78, 82, 75, 88, 80, 85, 77, 83, 79, 86, 81, 84, 76, 89, 87],
  "after": [72, 76, 69, 82, 74, 79, 71, 77, 73, 80, 75, 78, 70, 83, 81],
  "alpha": 0.05,
  "alternative": "less",
  "context": {
    "scenario": "general",
    "variable_name": "靜態心率 (次/分)",
    "measurement_type": "生理指標",
    "study_design": "訓練前後比較",
    "treatment": "有氧運動訓練"
  }
}
```

### 情境 3: 學習APP使用效果
**生活情境**: 測試使用學習APP一個月後記憶力測驗分數是否提升
**數據**: 同一組人使用APP前後的記憶力測驗分數

**測試數據**:
```json
{
  "before": [42, 38, 45, 41, 39, 44, 40, 43, 37, 46, 38, 42, 41, 39, 44],
  "after": [48, 44, 51, 47, 45, 50, 46, 49, 43, 52, 44, 48, 47, 45, 50],
  "alpha": 0.05,
  "alternative": "greater",
  "context": {
    "scenario": "education",
    "variable_name": "記憶力測驗分數",
    "measurement_type": "認知測驗分數",
    "study_design": "使用前後比較",
    "treatment": "記憶力訓練APP"
  }
}
```

## 特殊情境

### 情境 4: 疼痛評分改善（存在綁定值）
**研究背景**: 評估物理治療對慢性疼痛的改善效果，疼痛評分可能有相同值
**數據**: 疼痛視覺類比量表評分（0-10）

**測試數據**:
```json
{
  "before": [8, 7, 9, 6, 8, 7, 9, 8, 6, 7, 9, 8, 7, 6, 8],
  "after": [5, 4, 6, 3, 5, 4, 6, 5, 3, 4, 6, 5, 4, 3, 5],
  "alpha": 0.05,
  "alternative": "less",
  "context": {
    "scenario": "medical",
    "variable_name": "疼痛評分 (0-10)",
    "measurement_type": "視覺類比量表，可能有綁定值",
    "study_design": "治療前後比較",
    "treatment": "物理治療"
  }
}
```

### 情境 5: 睡眠品質改善評估
**研究背景**: 評估睡眠輔助產品對睡眠時數的影響
**數據**: 使用產品前後的睡眠時數

**測試數據**:
```json
{
  "before": [5.5, 6.2, 4.8, 6.8, 5.9, 6.1, 5.3, 6.5, 5.7, 6.0, 5.1, 6.3, 5.6, 6.4, 5.8],
  "after": [7.2, 7.8, 6.5, 8.1, 7.4, 7.7, 6.9, 8.0, 7.3, 7.6, 6.8, 7.9, 7.1, 8.2, 7.5],
  "alpha": 0.05,
  "alternative": "greater",
  "context": {
    "scenario": "general",
    "variable_name": "睡眠時數 (小時)",
    "measurement_type": "連續資料",
    "study_design": "使用前後比較",
    "treatment": "睡眠輔助產品"
  }
}
```

## 零差值處理情境

### 情境 6: 含零差值的治療效果評估
**研究背景**: 某些受試者治療前後無變化（零差值）
**處理方法**: 通常移除零差值後進行分析

**測試數據**:
```json
{
  "before": [25, 30, 22, 28, 26, 30, 24, 29, 27, 30, 23, 28, 25, 29, 26],
  "after": [20, 25, 22, 23, 21, 25, 19, 24, 22, 25, 18, 23, 20, 24, 21],
  "alpha": 0.05,
  "alternative": "less",
  "context": {
    "scenario": "medical",
    "variable_name": "症狀評分",
    "measurement_type": "可能含零差值",
    "study_design": "治療前後比較",
    "treatment": "康復治療",
    "zero_handling": "移除零差值"
  }
}
```

## 預期結果

### 統計專業用戶期望看到：
- W 統計量（符號秩和）
- Z 統計量（大樣本近似）
- 準確的 p 值
- 效果量（r = Z/√N）
- 中位數差異及其信賴區間
- 綁定值處理說明
- 零差值處理方式
- 符號秩統計量詳細資訊

### 一般用戶期望看到：
- 改善是否顯著的結論
- 改善程度的描述
- 中位數變化量
- 視覺化前後比較圖
- 實際意義說明
- 個別改善情況統計

## 測試指令範例

```bash
# 雙側檢定
curl -X POST http://localhost:3000/tools/stat/perform-wilcoxon \
  -H "Content-Type: application/json" \
  -d '{
    "before": [28,32,25,35,30],
    "after": [22,25,19,28,24],
    "alternative": "two-sided"
  }'

# 單側檢定（改善效果）
curl -X POST http://localhost:3000/tools/stat/perform-wilcoxon \
  -H "Content-Type: application/json" \
  -d '{
    "before": [75.2,82.1,68.5],
    "after": [72.8,79.5,66.1],
    "alternative": "less"
  }'
```

## 使用時機
- 配對資料不符合常態分佈
- 序位資料或間隔資料
- 樣本大小較小
- 存在極端值或離群值
- 差值分佈偏態
- 需要穩健的配對比較

## 假設檢驗條件
- 配對觀察值需獨立
- 資料至少為序位尺度
- 差值的分佈需對稱（用於檢定中位數差異）
- 隨機抽樣或隨機分派

## 與配對 t 檢定的比較
- **Wilcoxon**: 不需要常態性假設，較穩健
- **配對 t 檢定**: 需要差值常態分佈，檢定力較高（當假設成立時）
- **建議**: 當資料不符合常態性或樣本較小時使用 Wilcoxon

## AI 提問範例

### 範例 1: 醫療治療效果評估
**用戶提問**: "我是醫生，想評估一種新的物理治療對病患疼痛的改善效果。我有 10 位病患治療前後的疼痛評分（0-10 分）：治療前 [8, 7, 9, 6, 8, 7, 9, 8, 6, 7]，治療後 [5, 4, 6, 3, 5, 4, 6, 5, 3, 4]。如何分析治療是否有效？"

**AI 回應**: 這是典型的配對前後測設計，適合使用 Wilcoxon 符號秩檢定。由於疼痛評分是序位資料且樣本數較小，Wilcoxon 檢定比配對 t 檢定更適合。我來分析治療前後的差異是否具有統計顯著性。

**工具調用**:
```json
{
  "tool": "perform_wilcoxon",
  "data": {
    "sample1": [8, 7, 9, 6, 8, 7, 9, 8, 6, 7],
    "sample2": [5, 4, 6, 3, 5, 4, 6, 5, 3, 4],
    "alpha": 0.05,
    "alternative": "greater"
  },
  "context": {
    "scenario": "medical",
    "variable_name": "疼痛評分 (0-10)",
    "description": "評估物理治療對慢性疼痛的改善效果",
    "variable_names": {
      "sample1_name": "治療前",
      "sample2_name": "治療後"
    }
  },
  "visualizations": {
    "include_charts": true,
    "chart_types": ["difference_histogram", "paired_scatter", "boxplot"],
    "generate_image": true,
    "image_format": "png"
  }
}
```

### 範例 2: 個人健身效果追蹤
**用戶提問**: "我參加了一個為期 8 週的健身計畫，想知道我的體重是否有顯著變化。我每週測量體重：計畫前 [72.5, 73.1, 72.8, 73.2, 72.9, 73.0, 72.7, 73.3]，計畫後 [70.2, 70.8, 70.5, 71.1, 70.7, 70.9, 70.3, 71.0]。這個改變有統計意義嗎？"

**AI 回應**: 您想分析健身計畫前後的體重變化，這是配對數據分析。由於數據量較小且您想確認減重效果，我推薦使用 Wilcoxon 符號秩檢定，它對於小樣本和非常態分佈的數據很穩健。

**工具調用**:
```json
{
  "tool": "perform_wilcoxon",
  "data": {
    "sample1": [72.5, 73.1, 72.8, 73.2, 72.9, 73.0, 72.7, 73.3],
    "sample2": [70.2, 70.8, 70.5, 71.1, 70.7, 70.9, 70.3, 71.0],
    "alpha": 0.05,
    "alternative": "greater"
  },
  "context": {
    "scenario": "general",
    "variable_name": "體重 (公斤)",
    "description": "評估 8 週健身計畫的減重效果",
    "variable_names": {
      "sample1_name": "計畫前體重",
      "sample2_name": "計畫後體重"
    }
  },
  "visualizations": {
    "include_charts": true,
    "chart_types": ["difference_histogram", "paired_scatter"],
    "generate_image": true,
    "image_format": "png"
  }
}
```

### 範例 3: 軟板製程改善效果評估 - 白話提問
**用戶提問**: "我們軟板廠最近改善了製程，想知道良率是不是真的有提升。我收集了同一批設備改善前後的良率數據，但發現數據分佈不太正常，有點偏斜。

改善前的良率：92.1, 93.5, 91.8, 94.2, 92.7, 93.8, 91.4, 94.0, 92.9, 93.3
改善後的良率：94.8, 95.2, 94.1, 96.7, 95.3, 95.9, 94.2, 96.4, 95.6, 95.1

這個改善措施有效果嗎？能不能用統計方法來證明？"

**AI 回應**: 由於您的數據分佈有偏斜且是配對比較（同一批設備前後測），建議使用 Wilcoxon 符號秩檢定。這個方法不需要假設數據符合常態分佈，很適合您的情況。

**工具調用**:
```json
{
  "tool": "perform_wilcoxon",
  "data": {
    "sample1": [92.1, 93.5, 91.8, 94.2, 92.7, 93.8, 91.4, 94.0, 92.9, 93.3],
    "sample2": [94.8, 95.2, 94.1, 96.7, 95.3, 95.9, 94.2, 96.4, 95.6, 95.1],
    "alpha": 0.05,
    "alternative": "greater"
  },
  "context": {
    "scenario": "manufacturing",
    "description": "評估軟板製程改善前後的良率變化",
    "variable_names": {
      "sample1_name": "製程改善前",
      "sample2_name": "製程改善後"
    }
  }
}
```

### 範例 4: 軟板壓合條件最佳化 - 白話提問
**用戶提問**: "我們調整了軟板壓合的溫度，想看看對剝離強度有沒有改善。因為是同一批產品分成兩組做對比測試，數據樣本不大。

調整前的剝離強度：4.2, 4.5, 4.1, 4.8, 4.3, 4.6, 4.0, 4.7, 4.4, 4.5, 4.2, 4.9
調整後的剝離強度：5.1, 5.4, 4.8, 5.7, 5.2, 5.5, 4.9, 5.6, 5.3, 5.4, 5.0, 5.8

看起來好像有改善，但想用統計方法確認這個差異是否顯著？"

**AI 回應**: 您想比較同一批產品在不同壓合條件下的剝離強度，這是配對比較分析。由於樣本數不大且是工程測量數據，Wilcoxon 符號秩檢定是很好的選擇，能準確評估改善效果。

**工具調用**:
```json
{
  "tool": "perform_wilcoxon",
  "data": {
    "sample1": [4.2, 4.5, 4.1, 4.8, 4.3, 4.6, 4.0, 4.7, 4.4, 4.5, 4.2, 4.9],
    "sample2": [5.1, 5.4, 4.8, 5.7, 5.2, 5.5, 4.9, 5.6, 5.3, 5.4, 5.0, 5.8],
    "alpha": 0.05,
    "alternative": "greater"
  },
  "context": {
    "scenario": "manufacturing",
    "description": "評估壓合溫度調整對軟板剝離強度的改善效果",
    "variable_names": {
      "sample1_name": "溫度調整前",
      "sample2_name": "溫度調整後"
    }
  }
}
```
# Mann-Whitney U 檢定工具測試案例

## 工具概述
Mann-Whitney U 檢定（或 Wilcoxon 秩和檢定）是獨立樣本 t 檢定的非參數替代方法，用於比較兩個獨立群組的中位數是否有顯著差異，不需要假設資料符合常態分佈。

## 統計專業情境

### 情境 1: 藥物治療效果比較（偏態分佈）
**研究背景**: 比較新藥與安慰劑對疼痛緩解時間的效果，數據呈現右偏分佈
**研究設計**: 獨立樣本設計，無法滿足常態性假設
**假設**: H₀: 兩組中位數相等 vs H₁: 兩組中位數不等

**測試數據**:
```json
{
  "group1": [12, 15, 18, 22, 25, 28, 32, 35, 45, 58, 72, 89, 125, 156, 203],
  "group2": [8, 10, 12, 14, 16, 18, 20, 22, 25, 28, 30, 35, 42, 48, 65],
  "alpha": 0.05,
  "alternative": "two-sided",
  "context": {
    "scenario": "medical",
    "variable_name": "疼痛緩解時間 (分鐘)",
    "group1_name": "安慰劑組",
    "group2_name": "新藥組",
    "distribution_note": "右偏分佈，不符合常態性"
  }
}
```

### 情境 2: 心理量表分數比較
**研究背景**: 比較兩種治療方法對憂鬱量表分數的影響，量表分數為序位資料
**研究設計**: 隨機分組設計，使用 Likert 量表測量
**假設**: H₀: 兩組分數分佈相同 vs H₁: 兩組分數分佈不同

**測試數據**:
```json
{
  "group1": [42, 38, 45, 41, 39, 44, 40, 43, 37, 46, 38, 42, 41, 39, 44],
  "group2": [35, 31, 38, 34, 32, 37, 33, 36, 30, 39, 31, 35, 34, 32, 37],
  "alpha": 0.05,
  "alternative": "two-sided",
  "context": {
    "scenario": "medical",
    "variable_name": "憂鬱量表分數",
    "group1_name": "認知行為治療",
    "group2_name": "藥物治療",
    "distribution_note": "序位資料，Likert 量表"
  }
}
```

### 情境 3: 品質評分比較（小樣本）
**研究背景**: 比較兩個供應商的產品品質評分，樣本數較小
**研究設計**: 獨立樣本，小樣本情況
**假設**: H₀: 兩供應商品質評分相同 vs H₁: 兩供應商品質評分不同

**測試數據**:
```json
{
  "group1": [7.8, 8.2, 7.5, 8.9, 7.1, 8.5, 7.9, 8.3],
  "group2": [8.8, 9.1, 8.5, 9.3, 8.7, 9.0, 8.9, 9.2, 8.6],
  "alpha": 0.05,
  "alternative": "two-sided",
  "context": {
    "scenario": "quality",
    "variable_name": "品質評分 (1-10)",
    "group1_name": "供應商A",
    "group2_name": "供應商B",
    "distribution_note": "小樣本，未知分佈"
  }
}
```

### 情境 4: 軟板製造兩條生產線阻抗值比較
**研究背景**: 比較軟板製造兩條生產線的阻抗值表現，阻抗值數據可能偏態分佈
**研究設計**: 獨立樣本設計，兩條生產線各自獨立取樣
**假設**: H₀: 兩條生產線阻抗值中位數相同 vs H₁: 兩條生產線阻抗值中位數不同

**測試數據**:
```json
{
  "group1": [48.2, 49.8, 48.7, 50.3, 49.1, 49.9, 48.5, 50.1, 49.4, 48.8, 49.7, 48.9],
  "group2": [52.1, 53.7, 52.6, 54.2, 53.0, 53.8, 52.4, 54.0, 53.3, 52.7, 53.6, 52.8],
  "alpha": 0.05,
  "alternative": "two-sided",
  "context": {
    "scenario": "manufacturing",
    "variable_name": "阻抗值 (Ω)",
    "group1_name": "生產線A",
    "group2_name": "生產線B",
    "distribution_note": "阻抗值可能偏態分佈",
    "industry": "軟板製造業"
  }
}
```

### 情境 5: 軟板製造新舊製程銅厚分佈比較
**研究背景**: 比較軟板製造新舊製程的銅厚分佈差異，工程測量數據通常不符合常態分佈
**研究設計**: 獨立樣本設計，不同製程條件比較
**假設**: H₀: 新舊製程銅厚中位數相同 vs H₁: 新製程銅厚中位數更穩定

**測試數據**:
```json
{
  "group1": [17.2, 18.5, 16.8, 19.1, 17.6, 18.9, 16.4, 19.5, 17.8, 18.2, 16.9, 19.3, 17.4, 18.7],
  "group2": [18.8, 19.1, 18.5, 19.4, 18.9, 19.2, 18.7, 19.3, 18.6, 19.0, 18.4, 19.5, 18.9, 19.1],
  "alpha": 0.05,
  "alternative": "two-sided",
  "context": {
    "scenario": "manufacturing",
    "variable_name": "銅厚 (μm)",
    "group1_name": "舊製程",
    "group2_name": "新製程",
    "distribution_note": "工程測量，可能偏態",
    "industry": "軟板製造業",
    "process_parameter": "銅厚控制"
  }
}
```

## 一般用戶情境

### 情境 1: 兩家餐廳評價比較
**生活情境**: 想比較兩家餐廳在美食APP上的評分是否有差異
**數據**: 兩家餐廳最近一個月的顧客評分記錄

**測試數據**:
```json
{
  "group1": [4.2, 4.5, 3.8, 4.1, 4.3, 3.9, 4.4, 4.0, 4.2, 3.7, 4.1, 4.3, 3.8, 4.2, 4.0],
  "group2": [4.7, 4.8, 4.5, 4.9, 4.6, 4.8, 4.4, 4.7, 4.9, 4.5, 4.6, 4.8, 4.3, 4.7, 4.6],
  "alpha": 0.05,
  "alternative": "two-sided",
  "context": {
    "scenario": "general",
    "variable_name": "顧客評分 (1-5星)",
    "group1_name": "A餐廳",
    "group2_name": "B餐廳",
    "distribution_note": "評分資料，可能不符合常態分佈"
  }
}
```

### 情境 2: 兩個班級考試成績比較
**生活情境**: 比較兩個班級的數學考試成績，但成績分佈不均勻
**數據**: 兩班學生的考試成績，分佈偏態

**測試數據**:
```json
{
  "group1": [65, 70, 72, 75, 78, 80, 82, 85, 88, 90, 92, 95, 98],
  "group2": [58, 62, 68, 71, 74, 77, 80, 83, 86, 89, 91, 94, 97, 99],
  "alpha": 0.05,
  "alternative": "two-sided",
  "context": {
    "scenario": "education",
    "variable_name": "數學考試成績",
    "group1_name": "A班",
    "group2_name": "B班",
    "distribution_note": "成績分佈可能偏態"
  }
}
```

### 情境 3: 網路購物等待時間比較
**生活情境**: 比較兩個電商平台的配送時間，配送時間通常不符合常態分佈
**數據**: 兩個平台的配送天數記錄

**測試數據**:
```json
{
  "group1": [2, 3, 2, 4, 3, 5, 3, 4, 2, 6, 4, 3, 5, 7, 4, 3, 8, 5],
  "group2": [1, 2, 1, 3, 2, 2, 1, 3, 2, 4, 3, 2, 3, 1, 2, 4, 3, 2],
  "alpha": 0.05,
  "alternative": "two-sided",
  "context": {
    "scenario": "general",
    "variable_name": "配送天數",
    "group1_name": "平台A",
    "group2_name": "平台B",
    "distribution_note": "配送時間通常右偏分佈"
  }
}
```

## 單側檢定情境

### 情境 4: 新減重方法效果驗證（統計專業）
**研究背景**: 驗證新減重方法是否比傳統方法更有效
**假設**: H₀: 新方法 ≤ 傳統方法 vs H₁: 新方法 > 傳統方法

**測試數據**:
```json
{
  "group1": [2.5, 3.2, 1.8, 4.1, 3.5, 2.9, 3.8, 2.3, 4.5, 3.1, 2.7, 3.9, 2.1, 3.6, 2.8],
  "group2": [4.2, 5.1, 3.8, 5.9, 4.7, 5.3, 4.5, 5.8, 4.1, 5.5, 4.9, 5.2, 4.3, 5.7, 4.8],
  "alpha": 0.05,
  "alternative": "greater",
  "context": {
    "scenario": "medical",
    "variable_name": "體重減少 (公斤)",
    "group1_name": "傳統方法",
    "group2_name": "新方法",
    "test_direction": "新方法是否更有效"
  }
}
```

### 情境 5: 學習APP效果測試（一般用戶）
**生活情境**: 測試新的學習APP是否真的能提高學習效率
**假設**: 新APP的學習時間應該更短

**測試數據**:
```json
{
  "group1": [45, 52, 38, 61, 47, 55, 42, 58, 49, 54, 41, 56, 43, 59, 48],
  "group2": [35, 42, 28, 48, 37, 44, 32, 46, 39, 43, 31, 45, 33, 47, 38],
  "alpha": 0.05,
  "alternative": "less",
  "context": {
    "scenario": "education",
    "variable_name": "完成任務時間 (分鐘)",
    "group1_name": "傳統學習",
    "group2_name": "使用APP",
    "test_direction": "APP是否能縮短學習時間"
  }
}
```

## 預期結果

### 統計專業用戶期望看到：
- U 統計量和 Z 統計量
- 準確的 p 值（包括連續性校正）
- 效果量（r = Z/√N 或 η²）
- 秩和統計量
- 中位數及其信賴區間
- 常態性檢定結果說明
- 樣本大小適當性評估

### 一般用戶期望看到：
- 簡潔的比較結論
- 中位數比較結果
- 差異的實際意義說明
- 視覺化圖表（盒鬚圖）
- 為什麼選擇此檢定的說明
- 實用的建議

## 測試指令範例

```bash
# 雙側檢定
curl -X POST http://localhost:3000/tools/stat/perform-mann-whitney \
  -H "Content-Type: application/json" \
  -d '{
    "group1": [12,15,18,22,25],
    "group2": [8,10,12,14,16],
    "alternative": "two-sided"
  }'

# 單側檢定（group2 > group1）
curl -X POST http://localhost:3000/tools/stat/perform-mann-whitney \
  -H "Content-Type: application/json" \
  -d '{
    "group1": [2.5,3.2,1.8],
    "group2": [4.2,5.1,3.8],
    "alternative": "greater"
  }'
```

## 使用時機
- 資料不符合常態分佈
- 樣本大小較小
- 資料為序位資料或間隔資料
- 存在極端值或離群值
- 變異數不相等
- 想要更穩健的檢定方法

## 假設檢驗條件
- 兩組樣本需獨立
- 資料至少為序位尺度
- 兩組的資料分佈形狀相似（用於比較中位數）
- 隨機抽樣

## AI 提問範例

### 範例 1: 醫療研究情境
**用戶提問**: "我有兩組病患的治療效果數據，想比較新藥和安慰劑的效果。新藥組疼痛緩解時間是 [12, 15, 18, 22, 25, 28, 32, 35, 45, 58]，安慰劑組是 [25, 30, 35, 42, 48, 55, 62, 68, 75, 82]。數據分佈不太正常，應該用什麼統計方法？"

**AI 回應**: 根據您的描述，這是典型的兩組獨立樣本比較，且數據分佈不符合常態性假設。建議使用 Mann-Whitney U 檢定（非參數檢定）。我來為您分析這個數據。

**工具調用**:
```json
{
  "tool": "perform_mann_whitney",
  "data": {
    "group1": [25, 30, 35, 42, 48, 55, 62, 68, 75, 82],
    "group2": [12, 15, 18, 22, 25, 28, 32, 35, 45, 58],
    "alpha": 0.05,
    "alternative": "two-sided"
  },
  "context": {
    "scenario": "medical",
    "variable_name": "疼痛緩解時間 (分鐘)",
    "group1_name": "安慰劑組",
    "group2_name": "新藥組",
    "description": "比較新藥與安慰劑對疼痛緩解時間的效果"
  }
}
```

### 範例 2: 教育評估情境
**用戶提問**: "我是老師，想比較兩個班級的期末考成績。A班成績: [78, 82, 75, 88, 79, 85, 81, 77, 84, 80]，B班成績: [85, 89, 91, 87, 93, 88, 90, 86, 92, 89]。怎麼知道哪個班表現更好？"

**AI 回應**: 您想比較兩個班級的成績差異。由於考試成績可能不完全符合常態分佈，而且您關心的是整體表現差異，Mann-Whitney U 檢定是很好的選擇。這個檢定可以告訴您兩班成績是否有統計上的顯著差異。

**工具調用**:
```json
{
  "tool": "perform_mann_whitney",
  "data": {
    "group1": [78, 82, 75, 88, 79, 85, 81, 77, 84, 80],
    "group2": [85, 89, 91, 87, 93, 88, 90, 86, 92, 89],
    "alpha": 0.05,
    "alternative": "two-sided"
  },
  "context": {
    "scenario": "education",
    "variable_name": "期末考成績",
    "group1_name": "A班",
    "group2_name": "B班",
    "description": "比較兩個班級的期末考試表現"
  },
  "visualizations": {
    "include_charts": true,
    "chart_types": ["boxplot", "histogram"],
    "generate_image": true,
    "image_format": "png"
  }
}
```

### 範例 3: 軟板生產線阻抗值比較 - 白話提問
**用戶提問**: "我們有兩條軟板生產線，最近發現阻抗值好像不太一樣。生產線A的阻抗值大概在48-50歐姆之間，生產線B的阻抗值比較高，在52-54歐姆之間。數據分佈看起來不太正常，有點偏斜。

生產線A的阻抗值：48.2, 49.8, 48.7, 50.3, 49.1, 49.9, 48.5, 50.1, 49.4, 48.8, 49.7, 48.9
生產線B的阻抗值：52.1, 53.7, 52.6, 54.2, 53.0, 53.8, 52.4, 54.0, 53.3, 52.7, 53.6, 52.8

這兩條線的差異是真的有意義，還是只是正常波動？"

**AI 回應**: 由於您的阻抗值數據分佈不正常且有偏斜，建議使用 Mann-Whitney U 檢定。這個非參數統計方法不需要假設數據符合常態分佈，很適合比較兩條生產線的阻抗值差異。

**工具調用**:
```json
{
  "tool": "perform_mann_whitney",
  "data": {
    "group1": [48.2, 49.8, 48.7, 50.3, 49.1, 49.9, 48.5, 50.1, 49.4, 48.8, 49.7, 48.9],
    "group2": [52.1, 53.7, 52.6, 54.2, 53.0, 53.8, 52.4, 54.0, 53.3, 52.7, 53.6, 52.8],
    "alpha": 0.05,
    "alternative": "two-sided"
  },
  "context": {
    "scenario": "manufacturing",
    "description": "比較兩條軟板生產線的阻抗值差異",
    "variable_names": {
      "sample1_name": "生產線A",
      "sample2_name": "生產線B"
    }
  }
}
```

### 範例 4: 軟板製程銅厚控制比較 - 白話提問
**用戶提問**: "我們最近改善了軟板製程，想看看新製程的銅厚控制是不是比舊製程更穩定。舊製程的銅厚變化比較大，新製程看起來比較集中。因為是工程測量數據，分佈可能不太符合統計假設。

舊製程銅厚：17.2, 18.5, 16.8, 19.1, 17.6, 18.9, 16.4, 19.5, 17.8, 18.2, 16.9, 19.3, 17.4, 18.7
新製程銅厚：18.8, 19.1, 18.5, 19.4, 18.9, 19.2, 18.7, 19.3, 18.6, 19.0, 18.4, 19.5, 18.9, 19.1

能幫我分析看看新製程是不是真的有改善？"

**AI 回應**: 您想比較新舊製程的銅厚控制效果，由於工程測量數據可能不符合常態分佈，Mann-Whitney U 檢定是很好的選擇。這個檢定能告訴我們兩個製程的銅厚分佈是否有顯著差異。

**工具調用**:
```json
{
  "tool": "perform_mann_whitney",
  "data": {
    "group1": [17.2, 18.5, 16.8, 19.1, 17.6, 18.9, 16.4, 19.5, 17.8, 18.2, 16.9, 19.3, 17.4, 18.7],
    "group2": [18.8, 19.1, 18.5, 19.4, 18.9, 19.2, 18.7, 19.3, 18.6, 19.0, 18.4, 19.5, 18.9, 19.1],
    "alpha": 0.05,
    "alternative": "two-sided"
  },
  "context": {
    "scenario": "manufacturing",
    "description": "比較軟板製造新舊製程的銅厚控制效果",
    "variable_names": {
      "sample1_name": "舊製程",
      "sample2_name": "新製程"
    }
  }
}
```